<!DOCTYPE html>
<html lang="en">
    <head>
        <title>GaDo Studio | Edit Page</title>
        <link rel="shortcut icon" href="../../public/img/icons/Logo.png" />
        <link rel="stylesheet" href="../../src/private/styles/style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/css/swiper.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/js/swiper.min.js">
        <!-- Fuentes-->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css">
        <!-- JavaScript Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.6/css/swiper.min.css">
        <!-- Librerias Cropie -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">		
		    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
		    <link href="https://unpkg.com/cropperjs/dist/cropper.css" rel="stylesheet"/>
		    <script src="https://unpkg.com/cropperjs"></script>
		    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
		    <link rel="stylesheet" href="../../../src/private/styles/cropStyles.css">
        <script src="../../src/private/code/crop.js"></script>
    </head>
<body>
    <div class="pos-f-t">
        <div class="collapse" id="navbarToggleExternalContent">
          <div class="bg-light p-4">
            <h4 class="text-dark">Menu</h4>
            
            <a href="https://drive.google.com/drive/folders/1jV0d3DTs0QakGZLYAZpitso42Zo7LF3Y?usp=sharing" class="mon-reg">Información</a><br>
            <a href="" class="mon-reg">Ayuda</a><br>
          </div>
        </div>
        <nav class="navbar navbar-light bg-light shadow p-3 mb-5 bg-white scale-in-ver-bottom">
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <a class="navbar-brand" href="#">
            <img src="../../../src/public/img/icons/Logo.png" width="30" height="30" class="align-top justify-content-center" alt="">
            GaDo Studio
          </a>
          <a class="btn btn-outline-success" type="submit" href="mainmaster.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5z"/>
          </svg> Back</a>
        </nav>
      </div>
      <h4 style="text-align: center;">Editar Pagina</h4>
      

  <div class="portada">
    
		<div class="container" align="center">
			<div class="marco169">
				<div class="col-md-4">&nbsp;</div>

        
        <div class="FlexContainer">
					<div class="image_area border border-primary overflow-hidden">
						<form method="post">
							<label for="upload_image">
								<img src="../../../src/public/img/icons/galeryIcon.png" id="uploaded_image" class="card-img-right img-cover" />
								<div class="overlay">
								    <div class="text">Click para subir la imagen</div>
								</div>
			    				<input type="file" name="image" class="image" id="upload_image" style="display:none">
							</label>
			    		</form>
			    	</div>
			    </div>

          <div class="FlexContainer">
					<div class="image_area border border-primary overflow-hidden">
						<form method="post">
							<label for="upload_image">
								<img src="../../../src/public/img/icons/galeryIcon.png" id="uploaded_image" class="card-img-right img-cover" />
								<div class="overlay">
								    <div class="text">Click para subir la imagen</div>
								</div>
			    				<input type="file" name="image" class="image" id="upload_image" style="display:none">
							</label>
			    		</form>
			    	</div>
			    </div>
        

				
          
          

        <!-- MODAL -->
    		<div class="modal fade" id="modal" tabindex="-1"  aria-labelledby="modalLabel" aria-hidden="true">
			  	<div class="modal-dialog modal-lg" >
			    	<div class="modal-content">
			      		<div class="modal-header">
			        		<h5 class="modal-title" id="modalLabel">Edita la Imagen como sea necesario</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			      		</div>
			      		<div class="modal-body">
			        		<div class="img-container">
			            		<div class="row">
			                		<div class="col-md-4">
			                    		<img src="" class="imgmodal" id="sample_image" />
			                		</div>
			                		<div class="col-md-4">
			                    		<div class="preview"></div>
			                		</div>
			            		</div>
			        		</div>
			      		</div>
			      		<div class="modal-footer ">
							<button type="button" class="btn btn-primary" id="rotateLeft"><i class="bi bi-arrow-counterclockwise"></i></button>
						  	<button type="button" class="btn btn-primary" id="rotateRight"><i class="bi bi-arrow-clockwise"></i></button>
						  	<button type="button" class="btn btn-primary" id="mirrorX"><i class="bi bi-arrow-left-right"></i></button>
						  	<button type="button" class="btn btn-primary" id="mirrorY"><i class="bi bi-arrow-down-up"></i></button>
			        	 	<button type="button" class="btn btn-primary" id="crop">Crop</button>
						
			      		</div>
                <!-- MODAL -->	
			    	</div>
			  	</div>
			  </div>
        	
		</div>
	</div>
  



      <!-- BOTONES DE ACCION -->
    
      <!-- BOTONES DE ACCION -->

</body>
<br><br><br><br><br><br><br>
  <footer>
    <!-- Copyright -->
    <div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.05);">
      <img src="../../../src/public/img/icons/CloverNetLogoGray.png" alt="" width="25px" height="25px">
      © <script src="../../../src/private/code/copyrightyear.js"></script>
      <a class="text-reset" href="" target="_blank">CloverNet.com.mx</a>
    </div>
    <!-- Copyright -->
  </footer>
</html>

<script>
  $(document).ready(function(){
	//Variables para mirrorX() y mirrorY
	var counterY=1;
	var counterX=1;
	//Variables que Ya venían en el ejemplo
	var $modal = $('#modal');
	var image = document.getElementById('sample_image');
	var cropper;
	 
	$('#upload_image').change(function(event){
    	var files = event.target.files;
    	var done = function (url) {
      		image.src = url;
      		$modal.modal('show');
    	};
    

    	if (files && files.length > 0)
    	{
      		
        		reader = new FileReader();
		        reader.onload = function (event) {
		          	done(reader.result);
		        };
        		reader.readAsDataURL(files[0]);
      		
    	}
	});
	
	//Lo que se ve en el modal de edición

	$modal.on('shown.bs.modal', function() {
    	cropper = new Cropper(image, {
			
    		aspectRatio: 1.5/3,
    		viewMode: 3,
    		preview: '.preview',
			//cropBoxResizable : false,
			zoomOnWheel : true,
			zoomOnTouch : true,
			rotatable: true

    	});
	}).on('hidden.bs.modal', function() {
   		cropper.destroy();
   		cropper = null;
	});



	//Botones del Modal
	$("#rotateLeft").click(function(){
		cropper.rotate(-90);
	});
	$("#rotateRight").click(function(){
		cropper.rotate(90);
	});
	$("#mirrorX").click(function(){
		if (counterX %2 == 0) {
			cropper.scaleX(1);
		} else {
			cropper.scaleX(-1);
		}
	counterX++;
	});
	$("#mirrorY").click(function(){
		if (counterY %2 == 0) {
			cropper.scaleY(1);
		} else {
			cropper.scaleY(-1);
		}
	counterY++;	
	});	

	$("#crop").click(function(){
    	canvas = cropper.getCroppedCanvas({
		minWidth: 256,
 	 	minHeight: 256,
  		maxWidth: 4096,
  		maxHeight: 4096,
			
    	});
		//Función que guarda el canvas
    	canvas.toBlob(function(blob) {
        
        	var reader = new FileReader();
         	reader.readAsDataURL(blob); 
         	reader.onloadend = function() {
            	var base64data = reader.result;  
            
            	$.ajax({
            		url: "upload.php",
                	method: "POST",                	
                	data: {image: base64data},
                	success: function(data){
						
                    	console.log(data);
                    	$modal.modal('hide');
                    	$('#uploaded_image').attr('src', data);
                    	
                	}
              	});

				  
         	}
    	}); 
    });	

});
</script>